<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MobileGW Sync Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class='auto-refresh-indicator'>
        <span class='health-indicator healthy'></span>
        <span id='refreshStatus'>Автообновление: ВКЛ</span>
        <button class='btn btn-sm btn-link' onclick='toggleAutoRefresh()'>
            <i class='bi bi-pause-fill' id='refreshIcon'></i>
        </button>
    </div>

    <div class='dashboard-container'>
        <div class='d-flex justify-content-between align-items-center mb-4'>
            <h1 class='display-5 fw-bold'>
                <i class='bi bi-speedometer2'></i> MobileGW Sync Dashboard
            </h1>
            <div>
                <span class="navbar-text text-dark me-2">
                    <i class="bi bi-person-circle"></i> <span id="username"></span>
                </span>
                <span class='badge bg-primary' id='serverTime'>--:--:--</span>
                <button onclick="logout()" class="btn btn-sm btn-outline-danger ms-2">Выйти</button>
            </div>
        </div>

        <ul class='nav nav-pills mb-4' role='tablist'>
            <li class='nav-item'><a class='nav-link active' data-bs-toggle='pill' href='#overview'><i class='bi bi-grid-3x3-gap'></i> Обзор</a></li>
            <li class='nav-item'><a class='nav-link' data-bs-toggle='pill' href='#jobs'><i class='bi bi-calendar-check'></i> Задачи</a></li>
            <li class='nav-item'><a class='nav-link' data-bs-toggle='pill' href='#history'><i class='bi bi-clock-history'></i> История</a></li>
            <li class='nav-item'><a class='nav-link' data-bs-toggle='pill' href='#health'><i class='bi bi-heart-pulse'></i> Состояние</a></li>
        </ul>

        <div class='tab-content'>
            <div class='tab-pane fade show active' id='overview'>
                <div class='row g-4 mb-4' id="metrics-row"></div>
                <div class='row g-4'>
                    <div class='col-lg-8'><div class='table-container'><h5 class='mb-3'>Активность (7 дней)</h5><canvas id='activityChart'></canvas></div></div>
                    <div class='col-lg-4'><div class='table-container'><h5 class='mb-3'>Статусы (24 часа)</h5><canvas id='statusChart'></canvas></div></div>
                </div>
            </div>
            <div class='tab-pane fade' id='jobs'>
                <div class='table-container'>
                    <div class='d-flex justify-content-between align-items-center mb-3'>
                        <h5>Запланированные задачи</h5>
                        <button class='btn btn-primary btn-action' onclick='loadDashboardData()'><i class='bi bi-arrow-clockwise'></i> Обновить</button>
                    </div>
                    <div class="table-responsive"><table class='table'><thead><tr><th>Имя</th><th>Расписание</th><th>Прошлый запуск</th><th>Следующий</th><th>Статус</th><th>Действия</th></tr></thead><tbody id='jobsTable'></tbody></table></div>
                </div>
            </div>
            <div class='tab-pane fade' id='history'>
                <div class='table-container'>
                    <h5 class='mb-3'>История запусков</h5>
                    <div class="table-responsive"><table class='table'><thead><tr><th>Задача</th><th>Старт</th><th>Длительность</th><th>Записей</th><th>Статус</th><th>Действия</th></tr></thead><tbody id='historyTable'></tbody></table></div>
                </div>
            </div>
            <div class='tab-pane fade' id='health'>
                <div class='row g-4' id='healthCards'></div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="logsModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">Логи запуска</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body"><div class="table-responsive"><table class="table table-sm"><thead><tr><th>Шаг</th><th>Статус</th><th>Длительность</th><th>Детали</th></tr></thead><tbody id="logsTableBody"></tbody></table></div></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="dashboard.js"></script>
</body>
</html>